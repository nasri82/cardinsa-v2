<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Pricing & Quotation Engine - Interactive ERD</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: auto;
        }

        .header {
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .control-btn.active {
            background: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .erd-container {
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: calc(100vh - 200px);
            position: relative;
        }

        .erd-diagram {
            position: relative;
            width: 100%;
            max-width: 1400px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: visible;
        }

        .phase-section {
            margin-bottom: 40px;
            position: relative;
        }

        .phase-header {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            position: relative;
        }

        .table-entity {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            transition: all 0.4s ease;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .table-entity:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border-color: #4f46e5;
            background: rgba(255, 255, 255, 1);
        }

        .table-entity.core { border-left: 5px solid #10b981; }
        .table-entity.pricing { border-left: 5px solid #f59e0b; }
        .table-entity.quotation { border-left: 5px solid #3b82f6; }
        .table-entity.audit { border-left: 5px solid #8b5cf6; }
        .table-entity.advanced { border-left: 5px solid #ef4444; }

        .table-header {
            padding: 15px 20px;
            font-size: 1.1rem;
            font-weight: 700;
            color: #1f2937;
            border-bottom: 2px solid #f3f4f6;
            position: relative;
        }

        .table-header .table-type {
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: #f3f4f6;
            color: #6b7280;
            text-transform: uppercase;
            font-weight: 500;
        }

        .field-list {
            padding: 0;
        }

        .field-item {
            padding: 8px 20px;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }

        .field-item:hover {
            background: rgba(79, 70, 229, 0.05);
        }

        .field-item:last-child {
            border-bottom: none;
        }

        .field-name {
            font-weight: 500;
            color: #374151;
            font-size: 0.9rem;
        }

        .field-type {
            font-size: 0.8rem;
            color: #6b7280;
            background: #f9fafb;
            padding: 2px 8px;
            border-radius: 6px;
        }

        .primary-key {
            color: #dc2626 !important;
            font-weight: 700;
        }

        .primary-key::after {
            content: " 🔑";
            font-size: 0.8rem;
        }

        .foreign-key {
            color: #2563eb !important;
            font-weight: 600;
        }

        .foreign-key::after {
            content: " 🔗";
            font-size: 0.8rem;
        }

        .relationship-line {
            position: absolute;
            background: rgba(79, 70, 229, 0.7);
            z-index: 10;
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .relationship-line.show {
            opacity: 1;
        }

        .legend {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.1);
            width: 300px;
            transition: all 0.3s ease;
            transform: translateX(320px);
        }

        .legend.show {
            transform: translateX(0);
        }

        .legend h3 {
            margin-bottom: 15px;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 4px;
            height: 20px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .close {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .modal h2 {
            color: #1f2937;
            margin-bottom: 20px;
        }

        .modal-description {
            color: #6b7280;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .relationship-info {
            background: #f9fafb;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .relationship-info h4 {
            color: #374151;
            margin-bottom: 10px;
        }

        .relationship-list {
            list-style: none;
        }

        .relationship-list li {
            padding: 5px 0;
            color: #6b7280;
            border-bottom: 1px solid #e5e7eb;
        }

        .phase-indicator {
            position: absolute;
            top: -10px;
            left: 20px;
            background: linear-gradient(45deg, #4f46e5, #7c3aed);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .header p { font-size: 1rem; }
            .tables-grid { grid-template-columns: 1fr; }
            .legend { width: 250px; bottom: 10px; right: 10px; }
            .modal-content { width: 95%; margin: 2% auto; }
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.8rem;
            z-index: 1000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            white-space: nowrap;
        }

        .tooltip.show {
            opacity: 1;
        }

        .search-box {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.1);
            width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e5e7eb;
            border-radius: 10px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 10px rgba(79, 70, 229, 0.2);
        }

        .highlight {
            background: yellow !important;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { background: yellow; }
            50% { background: orange; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🏗️ Insurance Pricing & Quotation Engine</h1>
        <p>Interactive Entity Relationship Diagram - World-Class Database Architecture</p>
    </div>

    <div class="controls">
        <button class="control-btn active" onclick="showPhase('all')">All Tables</button>
        <button class="control-btn" onclick="showPhase('phase1')">Phase 1 - MVP</button>
        <button class="control-btn" onclick="showPhase('phase2')">Phase 2 - Enhanced</button>
        <button class="control-btn" onclick="showPhase('phase3')">Phase 3 - Intelligence</button>
        <button class="control-btn" onclick="toggleLegend()">Legend</button>
        <button class="control-btn" onclick="showRelationships()">Show Relationships</button>
    </div>

    <div class="search-box">
        <input type="text" class="search-input" placeholder="🔍 Search tables or fields..." onkeyup="searchTables(this.value)">
    </div>

    <div class="erd-container">
        <div class="erd-diagram">
            <!-- Phase 1: Core MVP -->
            <div class="phase-section phase1">
                <div class="phase-indicator">Phase 1 - MVP</div>
                <div class="phase-header">🚀 Phase 1: Core MVP Foundation</div>
                <div class="tables-grid">
                    <!-- Quotation Pricing Profiles -->
                    <div class="table-entity core" data-table="quotation_pricing_profiles" onclick="showTableDetails('quotation_pricing_profiles')">
                        <div class="table-header">
                            quotation_pricing_profiles
                            <span class="table-type">Core</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">name</span>
                                <span class="field-type">varchar(255)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">insurance_type</span>
                                <span class="field-type">varchar(50)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">base_premium</span>
                                <span class="field-type">numeric(15,2)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">risk_formula</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">benefit_value_consideration</span>
                                <span class="field-type">boolean</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotation Pricing Rules -->
                    <div class="table-entity pricing" data-table="quotation_pricing_rules" onclick="showTableDetails('quotation_pricing_rules')">
                        <div class="table-header">
                            quotation_pricing_rules
                            <span class="table-type">Rules</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">rule_name</span>
                                <span class="field-type">varchar(255)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">formula_expression</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">adjustment_type</span>
                                <span class="field-type">varchar(20)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">priority</span>
                                <span class="field-type">integer</span>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Calculations -->
                    <div class="table-entity pricing" data-table="premium_calculations" onclick="showTableDetails('premium_calculations')">
                        <div class="table-header">
                            premium_calculations
                            <span class="table-type">Calc</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">policy_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">base_premium</span>
                                <span class="field-type">numeric(15,2)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">final_premium</span>
                                <span class="field-type">numeric(15,2)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">calculation_details</span>
                                <span class="field-type">jsonb</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotations -->
                    <div class="table-entity quotation" data-table="quotations" onclick="showTableDetails('quotations')">
                        <div class="table-header">
                            quotations
                            <span class="table-type">Output</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">quote_number</span>
                                <span class="field-type">varchar(50)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">customer_name</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">customer_email</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">total_premium</span>
                                <span class="field-type">numeric(15,2)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotation Items -->
                    <div class="table-entity quotation" data-table="quotation_items" onclick="showTableDetails('quotation_items')">
                        <div class="table-header">
                            quotation_items
                            <span class="table-type">Detail</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">quotation_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">coverage_name</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">limit_amount</span>
                                <span class="field-type">numeric(12,2)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotation Versions -->
                    <div class="table-entity audit" data-table="quotation_versions" onclick="showTableDetails('quotation_versions')">
                        <div class="table-header">
                            quotation_versions
                            <span class="table-type">Audit</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">quotation_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">version_number</span>
                                <span class="field-type">integer</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">data_snapshot</span>
                                <span class="field-type">jsonb</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 2: Enhanced Features -->
            <div class="phase-section phase2">
                <div class="phase-indicator">Phase 2 - Enhanced</div>
                <div class="phase-header">⚡ Phase 2: Enhanced Pricing Components</div>
                <div class="tables-grid">
                    <!-- Premium Deductibles -->
                    <div class="table-entity advanced" data-table="premium_deductibles" onclick="showTableDetails('premium_deductibles')">
                        <div class="table-header">
                            premium_deductibles
                            <span class="table-type">Component</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">deductible_amount</span>
                                <span class="field-type">integer</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">factor</span>
                                <span class="field-type">numeric(5,3)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Copay -->
                    <div class="table-entity advanced" data-table="premium_copay" onclick="showTableDetails('premium_copay')">
                        <div class="table-header">
                            premium_copay
                            <span class="table-type">Component</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">service_type</span>
                                <span class="field-type">varchar(100)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">copay_percent</span>
                                <span class="field-type">numeric(5,2)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Age Brackets -->
                    <div class="table-entity core" data-table="age_brackets" onclick="showTableDetails('age_brackets')">
                        <div class="table-header">
                            age_brackets
                            <span class="table-type">Demo</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">bracket_name</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">min_age</span>
                                <span class="field-type">integer</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">max_age</span>
                                <span class="field-type">integer</span>
                            </div>
                        </div>
                    </div>

                    <!-- Agent Commissions -->
                    <div class="table-entity pricing" data-table="agent_commissions" onclick="showTableDetails('agent_commissions')">
                        <div class="table-header">
                            agent_commissions
                            <span class="table-type">Comm</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">quotation_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">commission_rate</span>
                                <span class="field-type">numeric</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">commission_amount</span>
                                <span class="field-type">numeric</span>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Industries -->
                    <div class="table-entity advanced" data-table="premium_industries" onclick="showTableDetails('premium_industries')">
                        <div class="table-header">
                            premium_industries
                            <span class="table-type">Risk</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name">industry_name</span>
                                <span class="field-type">varchar(100)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">load_factor</span>
                                <span class="field-type">numeric(5,3)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Plan Benefit Schedules -->
                    <div class="table-entity core" data-table="plan_benefit_schedules" onclick="showTableDetails('plan_benefit_schedules')">
                        <div class="table-header">
                            plan_benefit_schedules
                            <span class="table-type">Benefit</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">plan_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">benefit_name</span>
                                <span class="field-type">varchar(200)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">limit_amount</span>
                                <span class="field-type">numeric(15,2)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phase 3: Intelligence Layer -->
            <div class="phase-section phase3">
                <div class="phase-indicator">Phase 3 - Intelligence</div>
                <div class="phase-header">🧠 Phase 3: AI/ML Intelligence Layer</div>
                <div class="tables-grid">
                    <!-- Dynamic Pricing Models -->
                    <div class="table-entity advanced" data-table="dynamic_pricing_models" onclick="showTableDetails('dynamic_pricing_models')">
                        <div class="table-header">
                            dynamic_pricing_models
                            <span class="table-type">AI/ML</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">product_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">model_name</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">version</span>
                                <span class="field-type">text</span>
                            </div>
                        </div>
                    </div>

                    <!-- Market Competitive Rates -->
                    <div class="table-entity advanced" data-table="market_competitive_rates" onclick="showTableDetails('market_competitive_rates')">
                        <div class="table-header">
                            market_competitive_rates
                            <span class="table-type">Market</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">competitor_name</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">rate_value</span>
                                <span class="field-type">numeric</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">source</span>
                                <span class="field-type">text</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotation Pricing Rule Age Brackets -->
                    <div class="table-entity pricing" data-table="quotation_pricing_rule_age_brackets" onclick="showTableDetails('quotation_pricing_rule_age_brackets')">
                        <div class="table-header">
                            quotation_pricing_rule_age_brackets
                            <span class="table-type">Bridge</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">rule_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">age_bracket_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">multiplier</span>
                                <span class="field-type">numeric(8,4)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Actuarial Tables -->
                    <div class="table-entity core" data-table="actuarial_tables" onclick="showTableDetails('actuarial_tables')">
                        <div class="table-header">
                            actuarial_tables
                            <span class="table-type">Data</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">table_name</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">table_type</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">table_data</span>
                                <span class="field-type">jsonb</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotation Logs -->
                    <div class="table-entity audit" data-table="quotation_logs" onclick="showTableDetails('quotation_logs')">
                        <div class="table-header">
                            quotation_logs
                            <span class="table-type">Audit</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">quotation_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">status_from</span>
                                <span class="field-type">varchar(50)</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">status_to</span>
                                <span class="field-type">varchar(50)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Quotation Workflow Logs -->
                    <div class="table-entity audit" data-table="quotation_workflow_logs" onclick="showTableDetails('quotation_workflow_logs')">
                        <div class="table-header">
                            quotation_workflow_logs
                            <span class="table-type">Workflow</span>
                        </div>
                        <div class="field-list">
                            <div class="field-item">
                                <span class="field-name primary-key">id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name foreign-key">quotation_id</span>
                                <span class="field-type">uuid</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">event</span>
                                <span class="field-type">text</span>
                            </div>
                            <div class="field-item">
                                <span class="field-name">notes</span>
                                <span class="field-type">text</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="legend" id="legend">
        <h3>📊 Table Categories</h3>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #10b981;"></div>
            <span>Core Foundation Tables</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #f59e0b;"></div>
            <span>Pricing & Rules Engine</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #3b82f6;"></div>
            <span>Quotation & Output</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #8b5cf6;"></div>
            <span>Audit & Versioning</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background-color: #ef4444;"></div>
            <span>Advanced Components</span>
        </div>
        <div style="margin-top: 15px;">
            <div style="display: flex; align-items: center; margin-bottom: 8px;">
                <span style="margin-right: 10px;">🔑</span>
                <span style="font-size: 0.85rem;">Primary Key</span>
            </div>
            <div style="display: flex; align-items: center;">
                <span style="margin-right: 10px;">🔗</span>
                <span style="font-size: 0.85rem;">Foreign Key</span>
            </div>
        </div>
    </div>

    <!-- Modal for Table Details -->
    <div id="tableModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle">Table Details</h2>
            <div id="modalDescription" class="modal-description"></div>
            <div id="modalRelationships" class="relationship-info"></div>
        </div>
    </div>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Table definitions with detailed information
        const tableDefinitions = {
            quotation_pricing_profiles: {
                description: "Core pricing profile definitions that establish base premiums, risk formulas, and pricing boundaries for different insurance types. Includes benefit value consideration and network cost integration flags.",
                purpose: "Foundation for all pricing calculations",
                relationships: [
                    "Links to quotation_pricing_rules via quotation_pricing_profile_rules",
                    "Referenced by premium_calculations for base pricing",
                    "Connects to quotations through pricing workflow"
                ],
                phase: "Phase 1 - MVP"
            },
            quotation_pricing_rules: {
                description: "Advanced pricing rules engine with formula expressions, adjustment types, and priority ordering. Supports complex conditional logic for premium adjustments.",
                purpose: "Business logic for pricing calculations",
                relationships: [
                    "Links to quotation_pricing_profiles via junction table",
                    "Connects to age_brackets via quotation_pricing_rule_age_brackets",
                    "Used by premium_calculations for rule evaluation"
                ],
                phase: "Phase 1 - MVP"
            },
            premium_calculations: {
                description: "Central calculation engine storing base premiums, risk adjustments, and final premiums. Includes manual override capabilities and detailed calculation breakdown.",
                purpose: "Core premium calculation processing",
                relationships: [
                    "References policies and pricing models",
                    "Feeds into quotations for final pricing",
                    "Links to premium component tables for detailed calculations"
                ],
                phase: "Phase 1 - MVP"
            },
            quotations: {
                description: "Customer-facing quotations with complete customer information, coverage details, and final pricing. Supports multi-language content and workflow tracking.",
                purpose: "Final output for customer presentation",
                relationships: [
                    "Contains quotation_items for coverage breakdown",
                    "Tracked by quotation_logs for status changes",
                    "Versioned through quotation_versions",
                    "References agent_commissions for commission tracking"
                ],
                phase: "Phase 1 - MVP"
            },
            quotation_items: {
                description: "Detailed line items for each coverage within a quotation. Includes Arabic translations, coverage limits, and display ordering.",
                purpose: "Granular coverage breakdown",
                relationships: [
                    "Belongs to quotations (many-to-one)",
                    "References coverage definitions and benefit schedules"
                ],
                phase: "Phase 1 - MVP"
            },
            quotation_versions: {
                description: "Version control system for quotations with complete data snapshots. Enables rollback and change tracking.",
                purpose: "Audit trail and version management",
                relationships: [
                    "References quotations (many-to-one)",
                    "Maintains historical data snapshots"
                ],
                phase: "Phase 1 - MVP"
            },
            premium_deductibles: {
                description: "Global deductible factors that adjust premiums based on deductible amounts. Used for risk-based pricing adjustments.",
                purpose: "Deductible-based premium adjustments",
                relationships: [
                    "Used by premium_calculations for deductible adjustments",
                    "Referenced in plan_benefit_schedules for benefit design"
                ],
                phase: "Phase 2 - Enhanced"
            },
            premium_copay: {
                description: "Service-specific copay percentages with caps and detailed configuration options for different coverage types.",
                purpose: "Copay management and pricing",
                relationships: [
                    "Links to pricing profiles",
                    "Used in benefit calculations",
                    "Referenced by plan_benefit_schedules"
                ],
                phase: "Phase 2 - Enhanced"
            },
            age_brackets: {
                description: "Age-based demographic pricing with mortality and morbidity factors. Supports insurance type-specific age groupings.",
                purpose: "Demographic-based pricing foundation",
                relationships: [
                    "Links to actuarial_tables for statistical data",
                    "Connected to pricing rules via quotation_pricing_rule_age_brackets",
                    "Used in premium_calculations for age adjustments"
                ],
                phase: "Phase 2 - Enhanced"
            },
            agent_commissions: {
                description: "Commission tracking and calculation for sales agents with rate management and payment status tracking.",
                purpose: "Sales commission management",
                relationships: [
                    "References quotations for commission calculation",
                    "Links to agents and sales tracking",
                    "Connects to commission_rules for rate determination"
                ],
                phase: "Phase 2 - Enhanced"
            },
            premium_industries: {
                description: "Industry-specific loading factors for risk adjustment based on business sector and occupation classifications.",
                purpose: "Industry risk adjustments",
                relationships: [
                    "Used by premium_calculations for industry loading",
                    "Referenced in underwriting rules",
                    "Connects to customer occupation data"
                ],
                phase: "Phase 2 - Enhanced"
            },
            plan_benefit_schedules: {
                description: "Comprehensive benefit schedules with limits, cost-sharing, authorization requirements, and AI-generated summaries for customer understanding.",
                purpose: "Detailed benefit structure definition",
                relationships: [
                    "Belongs to plans (many-to-one)",
                    "References coverage categories",
                    "Links to premium calculations for benefit-based pricing"
                ],
                phase: "Phase 2 - Enhanced"
            },
            dynamic_pricing_models: {
                description: "AI/ML pricing models for real-time pricing adjustments based on market conditions, risk factors, and competitive analysis.",
                purpose: "Intelligent dynamic pricing",
                relationships: [
                    "References product_catalog for product-specific models",
                    "Feeds into premium_calculations for dynamic adjustments",
                    "Connects to market_competitive_rates for competitive pricing"
                ],
                phase: "Phase 3 - Intelligence"
            },
            market_competitive_rates: {
                description: "Competitive rate monitoring and analysis system for market-responsive pricing with source tracking and validity periods.",
                purpose: "Competitive intelligence for pricing",
                relationships: [
                    "Used by dynamic_pricing_models for market analysis",
                    "References companies and products",
                    "Feeds into pricing optimization algorithms"
                ],
                phase: "Phase 3 - Intelligence"
            },
            quotation_pricing_rule_age_brackets: {
                description: "Junction table linking pricing rules to age brackets with specific multipliers for age-based rule application.",
                purpose: "Age-specific pricing rule application",
                relationships: [
                    "Links quotation_pricing_rules to age_brackets (many-to-many)",
                    "Provides multipliers for age-based calculations"
                ],
                phase: "Phase 3 - Intelligence"
            },
            actuarial_tables: {
                description: "Statistical actuarial data including mortality, morbidity, and risk tables with regulatory approval tracking and version control.",
                purpose: "Statistical foundation for pricing",
                relationships: [
                    "Referenced by age_brackets for statistical factors",
                    "Used by premium_calculations for actuarial adjustments",
                    "Provides foundation for dynamic_pricing_models"
                ],
                phase: "Phase 3 - Intelligence"
            },
            quotation_logs: {
                description: "Complete audit trail of quotation status changes with actor tracking and detailed notes for compliance and workflow monitoring.",
                purpose: "Status change audit trail",
                relationships: [
                    "References quotations (many-to-one)",
                    "Tracks all status transitions",
                    "Provides compliance audit trail"
                ],
                phase: "Phase 3 - Intelligence"
            },
            quotation_workflow_logs: {
                description: "Detailed workflow event logging for quotation processing including approvals, reviews, and system events with timestamp tracking.",
                purpose: "Workflow process tracking",
                relationships: [
                    "References quotations (many-to-one)",
                    "Tracks workflow events and approvals",
                    "Provides process optimization insights"
                ],
                phase: "Phase 3 - Intelligence"
            }
        };

        // Show/hide phases
        function showPhase(phase) {
            // Update active button
            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Show/hide sections
            const sections = document.querySelectorAll('.phase-section');
            sections.forEach(section => {
                if (phase === 'all') {
                    section.style.display = 'block';
                } else {
                    section.style.display = section.classList.contains(phase) ? 'block' : 'none';
                }
            });
        }

        // Toggle legend
        function toggleLegend() {
            const legend = document.getElementById('legend');
            legend.classList.toggle('show');
        }

        // Show table details modal
        function showTableDetails(tableName) {
            const modal = document.getElementById('tableModal');
            const title = document.getElementById('modalTitle');
            const description = document.getElementById('modalDescription');
            const relationships = document.getElementById('modalRelationships');
            
            const tableInfo = tableDefinitions[tableName];
            
            title.textContent = tableName;
            description.innerHTML = `
                <p><strong>Description:</strong> ${tableInfo.description}</p>
                <p><strong>Purpose:</strong> ${tableInfo.purpose}</p>
                <p><strong>Implementation Phase:</strong> ${tableInfo.phase}</p>
            `;
            
            relationships.innerHTML = `
                <h4>🔗 Key Relationships:</h4>
                <ul class="relationship-list">
                    ${tableInfo.relationships.map(rel => `<li>${rel}</li>`).join('')}
                </ul>
            `;
            
            modal.style.display = 'block';
        }

        // Search functionality
        function searchTables(query) {
            const tables = document.querySelectorAll('.table-entity');
            const lowerQuery = query.toLowerCase();
            
            // Remove previous highlights
            document.querySelectorAll('.highlight').forEach(el => el.classList.remove('highlight'));
            
            if (query.length < 2) {
                tables.forEach(table => {
                    table.style.display = 'block';
                    table.style.opacity = '1';
                });
                return;
            }
            
            tables.forEach(table => {
                const tableName = table.dataset.table.toLowerCase();
                const fields = Array.from(table.querySelectorAll('.field-name')).map(el => el.textContent.toLowerCase());
                const allText = [tableName, ...fields].join(' ');
                
                if (allText.includes(lowerQuery)) {
                    table.style.display = 'block';
                    table.style.opacity = '1';
                    table.classList.add('highlight');
                    
                    // Highlight matching field names
                    table.querySelectorAll('.field-name').forEach(field => {
                        if (field.textContent.toLowerCase().includes(lowerQuery)) {
                            field.classList.add('highlight');
                        }
                    });
                    
                } else {
                    table.style.display = 'block';
                    table.style.opacity = '0.3';
                }
            });
        }

        // Show relationships (visual connections)
        function showRelationships() {
            // This would implement SVG lines between related tables
            alert('Relationship visualization feature would connect related tables with animated lines showing foreign key relationships!');
        }

        // Modal close functionality
        document.querySelector('.close').onclick = function() {
            document.getElementById('tableModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('tableModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // Tooltip functionality
        document.addEventListener('mouseover', function(e) {
            const tooltip = document.getElementById('tooltip');
            
            if (e.target.classList.contains('field-name')) {
                const fieldName = e.target.textContent;
                const tableEntity = e.target.closest('.table-entity');
                const tableName = tableEntity.dataset.table;
                
                let tooltipText = `Field: ${fieldName}`;
                if (e.target.classList.contains('primary-key')) {
                    tooltipText += ' (Primary Key)';
                } else if (e.target.classList.contains('foreign-key')) {
                    tooltipText += ' (Foreign Key)';
                }
                
                tooltip.textContent = tooltipText;
                tooltip.style.left = e.pageX + 10 + 'px';
                tooltip.style.top = e.pageY + 10 + 'px';
                tooltip.classList.add('show');
            }
        });

        document.addEventListener('mouseout', function(e) {
            if (e.target.classList.contains('field-name')) {
                document.getElementById('tooltip').classList.remove('show');
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-show legend after 2 seconds
            setTimeout(() => {
                document.getElementById('legend').classList.add('show');
            }, 2000);
            
            // Add some interactive animations
            document.querySelectorAll('.table-entity').forEach(table => {
                table.addEventListener('mouseenter', function() {
                    this.style.zIndex = '100';
                });
                
                table.addEventListener('mouseleave', function() {
                    this.style.zIndex = '1';
                });
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + F to focus search
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                document.querySelector('.search-input').focus();
            }
            
            // Escape to clear search
            if (e.key === 'Escape') {
                document.querySelector('.search-input').value = '';
                searchTables('');
            }
        });
    </script>
</body>
</html>